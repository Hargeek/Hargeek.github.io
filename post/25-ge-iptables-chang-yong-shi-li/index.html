<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>25个iptables常用示例 | 山山仙人博客</title>
<meta name="description" content="">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.7.2/css/all.css">
<link rel="shortcut icon" href="https://www.ssgeek.com/favicon.ico?v=1714317474949">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://www.ssgeek.com/styles/main.css">


  
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/gitalk/1.6.2/gitalk.css" />
  

  


<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script data-ad-client="ca-pub-6775328896166270" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4b826a92a3dc151a74693fa1942d3167";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/aos/2.3.4/aos.css" />


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-147397031-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147397031-1');
</script>


  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://www.ssgeek.com">
        <img src="https://www.ssgeek.com/images/avatar.png?v=1714317474949" class="site-logo">
        <h1 class="site-title">山山仙人博客</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://www.ssgeek.com" class="site-nav">
            首页
          </a>
        
      
        
          <a href="https://www.ssgeek.com/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="https://www.ssgeek.com/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/about/" class="site-nav">
            关于
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/gong-zhong-hao/" class="site-nav">
            公众号
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/you-qing-lian-jie/" class="site-nav">
            友情链接
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/hargeek" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
          <a class="social-link" href="https://twitter.com/anronghong" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        
      
        
          <a class="social-link" href="https://weibo.com/u/5717964658" target="_blank">
            <i class="fab fa-weibo"></i>
          </a>
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/hong-an-rong-46/activities" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
          <a class="social-link" href="https://www.facebook.com/profile.php?id=100041470532098" target="_blank">
            <i class="fab fa-facebook"></i>
          </a>
        
      
    </div>
    <div class="site-description">
      
    </div>
    <div class="site-footer">
      <a href="https://beian.miit.gov.cn" style="text-decoration:none;">鄂ICP备18007156号-1</a></br></br>Copyright © All Rights Reserved | <a class="rss" href="https://www.ssgeek.com/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>

      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">25个iptables常用示例</h2>
            <div class="post-date">2018-12-01</div>
            
            <div class="post-content">
              <p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E6%A0%BC%E5%BC%8F">格式</a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B">示例</a>
<ul>
<li><a href="#1-%E5%88%A0%E9%99%A4%E5%B7%B2%E6%9C%89%E8%A7%84%E5%88%99">1、删除已有规则</a></li>
<li><a href="#2-%E8%AE%BE%E7%BD%AE%E9%93%BE%E7%9A%84%E9%BB%98%E8%AE%A4%E7%AD%96%E7%95%A5">2、设置链的默认策略</a></li>
<li><a href="#3-%E9%98%BB%E6%AD%A2%E6%8C%87%E5%AE%9Aip%E5%9C%B0%E5%9D%80">3、阻止指定IP地址</a></li>
<li><a href="#4-%E5%85%81%E8%AE%B8%E6%89%80%E6%9C%89ssh%E7%9A%84%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">4、允许所有SSH的连接请求</a></li>
<li><a href="#5-%E4%BB%85%E5%85%81%E8%AE%B8%E6%9D%A5%E8%87%AA%E6%8C%87%E5%AE%9A%E7%BD%91%E7%BB%9C%E7%9A%84ssh%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">5、仅允许来自指定网络的SSH连接请求</a></li>
<li><a href="#6-%E5%85%81%E8%AE%B8http%E5%92%8Chttps%E7%9A%84%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">6、允许http和https的连接请求</a></li>
<li><a href="#7-%E4%BD%BF%E7%94%A8multiport-%E5%B0%86%E5%A4%9A%E4%B8%AA%E8%A7%84%E5%88%99%E7%BB%93%E5%90%88%E5%9C%A8%E4%B8%80%E8%B5%B7">7、使用multiport 将多个规则结合在一起</a></li>
<li><a href="#8-%E5%85%81%E8%AE%B8%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%8F%91%E8%B5%B7%E7%9A%84ssh">8、允许从本地发起的SSH</a></li>
<li><a href="#9-%E4%BB%85%E5%85%81%E8%AE%B8%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%8F%91%E8%B5%B7%E5%88%B0%E4%B8%80%E4%B8%AA%E6%8C%87%E5%AE%9A%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9F%9F%E7%9A%84ssh%E8%AF%B7%E6%B1%82">9、仅允许从本地发起到一个指定的网络域的SSH请求</a></li>
<li><a href="#10-%E5%85%81%E8%AE%B8%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%8F%91%E8%B5%B7%E7%9A%84https%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">10、允许从本地发起的HTTPS连接请求</a></li>
<li><a href="#11-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%BC%A0%E5%85%A5%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F">11、负载均衡传入的网络流量</a></li>
<li><a href="#12-%E5%85%81%E8%AE%B8%E5%A4%96%E9%83%A8%E4%B8%BB%E6%9C%BAping%E5%86%85%E9%83%A8%E4%B8%BB%E6%9C%BA">12、允许外部主机ping内部主机</a></li>
<li><a href="#13-%E5%85%81%E8%AE%B8%E5%86%85%E9%83%A8%E4%B8%BB%E6%9C%BAping%E5%A4%96%E9%83%A8%E4%B8%BB%E6%9C%BA">13、允许内部主机ping外部主机</a></li>
<li><a href="#14-%E5%85%81%E8%AE%B8%E5%9B%9E%E7%8E%AF%E8%AE%BF%E9%97%AE">14、允许回环访问</a></li>
<li><a href="#15-%E5%85%81%E8%AE%B8%E5%86%85%E9%83%A8%E7%BD%91%E7%BB%9C%E5%9F%9F%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E9%80%9A%E4%BF%A1">15、允许内部网络域外部网络的通信</a></li>
<li><a href="#16-%E5%85%81%E8%AE%B8%E5%87%BA%E7%AB%99%E7%9A%84dns%E8%BF%9E%E6%8E%A5">16、允许出站的DNS连接</a></li>
<li><a href="#17-%E5%85%81%E8%AE%B8nis%E8%BF%9E%E6%8E%A5">17、允许NIS连接</a></li>
<li><a href="#18-%E5%85%81%E8%AE%B8%E6%9D%A5%E8%87%AA%E6%8C%87%E5%AE%9A%E7%BD%91%E7%BB%9C%E7%9A%84rsync%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">18、允许来自指定网络的rsync连接请求</a></li>
<li><a href="#19-%E5%85%81%E8%AE%B8%E6%9D%A5%E8%87%AA%E6%8C%87%E5%AE%9A%E7%BD%91%E7%BB%9C%E7%9A%84mysql%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82">19、允许来自指定网络的MySQL连接请求</a></li>
<li><a href="#20-%E5%85%81%E8%AE%B8sendmail-postfix%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1">20、允许Sendmail, Postfix邮件服务</a></li>
<li><a href="#21-%E5%85%81%E8%AE%B8imap%E5%92%8Cimaps">21. 允许IMAP和IMAPS</a></li>
<li><a href="#22-%E5%85%81%E8%AE%B8pop3%E5%92%8Cpop3s">22、允许POP3和POP3S</a></li>
<li><a href="#23-%E9%98%B2%E6%AD%A2dos%E6%94%BB%E5%87%BB">23、防止DoS攻击</a></li>
<li><a href="#24-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91">24、端口转发</a></li>
<li><a href="#25-%E8%AE%B0%E5%BD%95%E4%B8%A2%E5%BC%83%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A1%A8">25、记录丢弃的数据表</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<blockquote>
<p>本文将给出25个<code>iptables</code>常用规则示例，这些例子为您提供了些基本的模板，您可以根据特定需求对其进行修改调整以达到期望。</p>
</blockquote>
<h2 id="格式">格式</h2>
<pre><code>iptables [-t 表名] 选项 [链名] [条件] [-j 控制类型] 参数
-P 设置默认策略:iptables -P INPUT (DROP|ACCEPT)
-F 清空规则链
-L 查看规则链
-A 在规则链的末尾加入新规则
-I num 在规则链的头部加入新规则
-D num 删除某一条规则
-s 匹配来源地址IP/MASK，加叹号&quot;!&quot;表示除这个IP外。
-d 匹配目标地址
-i 网卡名称 匹配从这块网卡流入的数据
-o 网卡名称 匹配从这块网卡流出的数据
-p 匹配协议,如tcp,udp,icmp
--dport num 匹配目标端口号
--sport num 匹配来源端口号
</code></pre>
<h2 id="示例">示例</h2>
<h3 id="1-删除已有规则">1、删除已有规则</h3>
<p>在开始创建<code>iptables</code>规则之前，你也许需要删除已有规则。<br>
命令如下：</p>
<pre><code>iptables -F
(or)
iptables –flush
</code></pre>
<h3 id="2-设置链的默认策略">2、设置链的默认策略</h3>
<p>链的默认政策设置为<code>”ACCEPT”</code>（接受），若要将<code>INPUT</code>,<code>FORWARD</code>,<code>OUTPUT</code>链设置成<code>”DROP”</code>（拒绝），命令如下：</p>
<pre><code>iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
</code></pre>
<p>当<code>INPUT</code>链和<code>OUTPUT</code>链都设置成<code>DROP</code>时，对于每一个防火墙规则，我们都应该定义两个规则。例如：一个传入另一个传出。在下面所有的例子中，由于我们已将<code>DROP</code>设置成<code>INPUT</code>链和<code>OUTPUT</code>链的默认策略，每种情况我们都将制定两条规则。当然，如果你相信你的内部用户,则可以省略上面的最后一行。例如：默认不丢弃所有出站的数据包。在这种情况下,对于每一个防火墙规则要求,你只需要制定一个规则——只对进站的数据包制定规则。</p>
<h3 id="3-阻止指定ip地址">3、阻止指定IP地址</h3>
<p>例：丢弃来自IP地址x.x.x.x的包</p>
<pre><code>iptables -A INPUT -s x.x.x.x -j DROP
</code></pre>
<p>注：当你在log里发现来自某ip地址的异常记录，可以通过此命令暂时阻止该地址的访问以做更深入分析</p>
<p>例：阻止来自IP地址x.x.x.x eth0 tcp的包</p>
<pre><code>iptables -A INPUT -i eth0 -s x.x.x.x -j DROP
iptables -A INPUT -i eth0 -p tcp -s x.x.x.x -j DROP
</code></pre>
<h3 id="4-允许所有ssh的连接请求">4、允许所有SSH的连接请求</h3>
<p>例：允许所有来自外部的<code>SSH</code>连接请求，即只允许进入<code>eth0</code>接口，并且目标端口为22的数据包</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="5-仅允许来自指定网络的ssh连接请求">5、仅允许来自指定网络的SSH连接请求</h3>
<p>例：仅允许来自于192.168.100.0/24域的用户的ssh连接请求</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="6-允许http和https的连接请求">6、允许http和https的连接请求</h3>
<p>例：允许所有来自web - http的连接请求</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p>例：允许所有来自web - https的连接请求</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="7-使用multiport-将多个规则结合在一起">7、使用multiport 将多个规则结合在一起</h3>
<p>允许多个端口从外界连入，除了为每个端口都写一条独立的规则外，我们可以用multiport将其组合成一条规则。如下所示：  例：允许所有ssh,http,https的流量访问</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="8-允许从本地发起的ssh">8、允许从本地发起的SSH</h3>
<pre><code>iptables -A OUTPUT -o eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p>请注意,这与允许<code>ssh</code>连入的规则略有不同。本例在<code>OUTPUT</code>链上，我们允许<code>NEW</code>和<code>ESTABLISHED</code>状态。在<code>INPUT</code>链上，我们只允许<code>ESTABLISHED</code>状态。<code>ssh</code>连入的规则与之相反。</p>
<h3 id="9-仅允许从本地发起到一个指定的网络域的ssh请求">9、仅允许从本地发起到一个指定的网络域的SSH请求</h3>
<p>例：仅允许从内部连接到网域<code>192.168.100.0/24</code></p>
<pre><code>iptables -A OUTPUT -o eth0 -p tcp -d 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="10-允许从本地发起的https连接请求">10、允许从本地发起的HTTPS连接请求</h3>
<p>下面的规则允许输出安全的网络流量。如果你想允许用户访问互联网，这是非常有必要的。在服务器上，这些规则能让你使用wget从外部下载一些文件</p>
<pre><code>iptables -A OUTPUT -o eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p>注：对于HTTP web流量的外联请求，只需要将上述命令中的端口从443改成80即可。</p>
<h3 id="11-负载均衡传入的网络流量">11、负载均衡传入的网络流量</h3>
<p>使用iptables可以实现传入web流量的负载均衡，我们可以传入web流量负载平衡使用iptables防火墙规则。  例：使用iptables nth将HTTPS流量负载平衡至三个不同的ip地址。</p>
<pre><code>iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443
</code></pre>
<h3 id="12-允许外部主机ping内部主机">12、允许外部主机ping内部主机</h3>
<pre><code>iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT
</code></pre>
<h3 id="13-允许内部主机ping外部主机">13、允许内部主机ping外部主机</h3>
<pre><code>iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
</code></pre>
<h3 id="14-允许回环访问">14、允许回环访问</h3>
<p>例：在服务器上允许127.0.0.1回环访问。</p>
<pre><code>iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
</code></pre>
<h3 id="15-允许内部网络域外部网络的通信">15、允许内部网络域外部网络的通信</h3>
<p>防火墙服务器上的其中一个网卡连接到外部，另一个网卡连接到内部服务器，使用以下规则允许内部网络与外部网络的通信。此例中，<code>eth1</code>连接到外部网络(互联网)，<code>eth0</code>连接到内部网络(例如:<code>192.168.1.x</code>)。</p>
<pre><code>iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
</code></pre>
<h3 id="16-允许出站的dns连接">16、允许出站的DNS连接</h3>
<pre><code>iptables -A OUTPUT -p udp -o eth0 --dport 53 -j ACCEPT
iptables -A INPUT -p udp -i eth0 --sport 53 -j ACCEPT
</code></pre>
<h3 id="17-允许nis连接">17、允许NIS连接</h3>
<p>如果你使用NIS管理用户帐户，你需要允许NIS连接。如果你不允许NIS相关的ypbind连接请求，即使SSH连接请求已被允许，用户仍然无法登录。NIS的端口是动态的，先使用命令rpcinfo –p来知道端口号，此例中为853和850端口。  <code>rpcinfo -p | grep ypbind</code><br>
例：允许来自111端口以及ypbind使用端口的连接请求</p>
<pre><code>iptables -A INPUT -p tcp --dport 111 -j ACCEPT
iptables -A INPUT -p udp --dport 111 -j ACCEPT
iptables -A INPUT -p tcp --dport 853 -j ACCEPT
iptables -A INPUT -p udp --dport 853 -j ACCEPT
iptables -A INPUT -p tcp --dport 850 -j ACCEPT
iptables -A INPUT -p udp --dport 850 -j ACCEPT
</code></pre>
<p>注：当你重启<code>ypbind之</code>后端口将不同，上述命令将无效。有两种解决方案：1）使用你NIS的静态IP 2）编写<code>shell</code>脚本通过<code>“rpcinfo - p”</code>命令自动获取动态端口号,并在上述<code>iptables</code>规则中使用。</p>
<h3 id="18-允许来自指定网络的rsync连接请求">18、允许来自指定网络的rsync连接请求</h3>
<p>例：允许来自网络<code>192.168.101.0/24</code>的<code>rsync</code>连接请求</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="19-允许来自指定网络的mysql连接请求">19、允许来自指定网络的MySQL连接请求</h3>
<p>很多情况下，<code>MySQL</code>数据库与<code>web</code>服务跑在同一台服务器上。有时候我们仅希望<code>DBA</code>和开发人员从内部网络<code>192.168.100.0/24</code>直接登录数据库，可尝试以下命令：</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="20-允许sendmail-postfix邮件服务">20、允许Sendmail, Postfix邮件服务</h3>
<p><code>Sendmail</code>和<code>postfix</code>都使用了25端口，因此我们只需要允许来自25端口的连接请求即可。</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="21-允许imap和imaps">21. 允许IMAP和IMAPS</h3>
<p>例：允许<code>IMAP/IMAP2</code>流量，端口为<code>143</code></p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 143 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 143 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p>例：允许<code>IMAPS</code>流量，端口为<code>993</code></p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 993 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 993 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="22-允许pop3和pop3s">22、允许POP3和POP3S</h3>
<p>例：允许<code>POP3</code>访问</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 110 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 110 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p>例：允许<code>POP3S</code>访问</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 995 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 995 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="23-防止dos攻击">23、防止DoS攻击</h3>
<pre><code>iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
</code></pre>
<p>上述例子中：<br>
<code>-m limit</code>: 启用limit扩展<br>
<code>–limit 25/minute</code>: 允许最多每分钟25个连接（根据需求更改）。<br>
<code>–limit-burst 100</code>: 只有当连接达到limit-burst水平(此例为100)时才启用上述limit/minute限制。</p>
<h3 id="24-端口转发">24、端口转发</h3>
<p>例：将来自422端口的流量全部转到22端口。  这意味着我们既能通过422端口又能通过22端口进行ssh连接。启用DNAT转发。</p>
<pre><code>iptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22
</code></pre>
<p>除此之外，还需要允许连接到422端口的请求</p>
<pre><code>iptables -A INPUT -i eth0 -p tcp --dport 422 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 422 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="25-记录丢弃的数据表">25、记录丢弃的数据表</h3>
<p>第一步：新建名为<code>LOGGING</code>的链</p>
<pre><code>iptables -N LOGGING
</code></pre>
<p>第二步：将所有来自<code>INPUT</code>链中的数据包跳转到<code>LOGGING</code>链中</p>
<pre><code>iptables -A INPUT -j LOGGING
</code></pre>
<p>第三步：为这些包自定义个前缀，命名为<code>”IPTables Packet Dropped”</code></p>
<pre><code>iptables -A LOGGING -m limit --limit 2/min -j LOG --log-prefix &quot;IPTables Packet Dropped: &quot; --log-level 7
</code></pre>
<p>第四步：丢弃这些数据包</p>
<pre><code>iptables -A LOGGING -j DROP
</code></pre>
<p>文章来源：https://www.cnblogs.com/bill1015/p/6847841.html</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://www.ssgeek.com/tag/onEdwbr5v" class="tag">
                    iptables
                  </a>
                
                  <a href="https://www.ssgeek.com/tag/linux" class="tag">
                    linux
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://www.ssgeek.com/post/shi-yong-git-svn-qian-yi-svn-zhi-gitlab">
                  <h3 class="post-title">
                    使用git-svn迁移SVN至GitLab
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/aos/2.3.4/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '22c870a7f8551b566598',
        clientSecret: '1acfdedd403cdf39c4a6ce932a4a991bb2b32e3a',
        repo: 'hargeek.github.io',
        owner: 'hargeek',
        admin: ['hargeek'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  


  </body>
</html>
