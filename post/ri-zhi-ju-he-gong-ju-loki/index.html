<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>æ—¥å¿—èšåˆå·¥å…·loki | å±±å±±ä»™äººåšå®¢</title>
<meta name="description" content="">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.7.2/css/all.css">
<link rel="shortcut icon" href="https://www.ssgeek.com/favicon.ico?v=1714317474949">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://www.ssgeek.com/styles/main.css">


  
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/gitalk/1.6.2/gitalk.css" />
  

  


<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script data-ad-client="ca-pub-6775328896166270" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4b826a92a3dc151a74693fa1942d3167";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/aos/2.3.4/aos.css" />


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-147397031-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147397031-1');
</script>


  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://www.ssgeek.com">
        <img src="https://www.ssgeek.com/images/avatar.png?v=1714317474949" class="site-logo">
        <h1 class="site-title">å±±å±±ä»™äººåšå®¢</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://www.ssgeek.com" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="https://www.ssgeek.com/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="https://www.ssgeek.com/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/about/" class="site-nav">
            å…³äº
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/gong-zhong-hao/" class="site-nav">
            å…¬ä¼—å·
          </a>
        
      
        
          <a href="https://www.ssgeek.com/post/you-qing-lian-jie/" class="site-nav">
            å‹æƒ…é“¾æ¥
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/hargeek" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
          <a class="social-link" href="https://twitter.com/anronghong" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        
      
        
          <a class="social-link" href="https://weibo.com/u/5717964658" target="_blank">
            <i class="fab fa-weibo"></i>
          </a>
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/hong-an-rong-46/activities" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
          <a class="social-link" href="https://www.facebook.com/profile.php?id=100041470532098" target="_blank">
            <i class="fab fa-facebook"></i>
          </a>
        
      
    </div>
    <div class="site-description">
      
    </div>
    <div class="site-footer">
      <a href="https://beian.miit.gov.cn" style="text-decoration:none;">é„‚ICPå¤‡18007156å·-1</a></br></br>Copyright Â© All Rights Reserved | <a class="rss" href="https://www.ssgeek.com/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>

      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">æ—¥å¿—èšåˆå·¥å…·loki</h2>
            <div class="post-date">2019-09-25</div>
            
            <div class="post-content">
              <p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-loki%E6%98%AF%E4%BB%80%E4%B9%88">1ã€lokiæ˜¯ä»€ä¹ˆ</a></li>
<li><a href="#2-loki%E7%89%B9%E7%82%B9">2ã€lokiç‰¹ç‚¹</a></li>
<li><a href="#3-loki%E7%BB%84%E6%88%90">3ã€lokiç»„æˆ</a></li>
<li><a href="#4-loki%E5%AE%89%E8%A3%85">4ã€lokiå®‰è£…</a>
<ul>
<li><a href="#41-%E6%B7%BB%E5%8A%A0helm%E7%9A%84chart%E5%BA%93">4.1ã€æ·»åŠ helmçš„chartåº“</a></li>
<li><a href="#42-%E5%AE%89%E8%A3%85loki%E5%8F%8Apromtail">4.2ã€å®‰è£…lokiåŠpromtail</a></li>
<li><a href="#43-%E5%AE%89%E8%A3%85grafana">4.3ã€å®‰è£…grafana</a></li>
</ul>
</li>
<li><a href="#5-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8">5ã€é…ç½®å’Œä½¿ç”¨</a></li>
<li><a href="#6-%E6%97%A5%E5%BF%97%E9%80%89%E6%8B%A9%E5%92%8C%E8%BF%87%E6%BB%A4">6ã€æ—¥å¿—é€‰æ‹©å’Œè¿‡æ»¤</a>
<ul>
<li><a href="#61-%E6%97%A5%E5%BF%97%E9%80%89%E6%8B%A9%E5%99%A8">6.1ã€æ—¥å¿—é€‰æ‹©å™¨</a></li>
<li><a href="#62-%E6%97%A5%E5%BF%97%E8%BF%87%E6%BB%A4%E5%99%A8">6.2ã€æ—¥å¿—è¿‡æ»¤å™¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<br>
ğŸ˜‡å°é¢å›¾ç‰‡æ¥è‡ªäº<a href="https://grafana.com/oss/loki#about">lokiå®˜ç½‘</a></p>
<h2 id="1-lokiæ˜¯ä»€ä¹ˆ">1ã€lokiæ˜¯ä»€ä¹ˆ</h2>
<p><a href="https://github.com/grafana/loki">Loki</a>æ˜¯ä¸€ä¸ªæ°´å¹³å¯æ‰©å±•ï¼Œé«˜å¯ç”¨æ€§ï¼Œå¤šç§Ÿæˆ·çš„æ—¥å¿—èšåˆç³»ç»Ÿï¼Œå—åˆ°Prometheusçš„å¯å‘ã€‚å®ƒçš„è®¾è®¡éå¸¸ç»æµé«˜æ•ˆä¸”æ˜“äºæ“ä½œï¼Œå› ä¸ºå®ƒä¸ä¼šä¸ºæ—¥å¿—å†…å®¹ç¼–åˆ¶ç´¢å¼•ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªæ—¥å¿—æµç¼–åˆ¶ä¸€ç»„æ ‡ç­¾ã€‚å®˜æ–¹ä»‹ç»è¯´åˆ°ï¼šLike Prometheus, but for logs.</p>
<h2 id="2-lokiç‰¹ç‚¹">2ã€lokiç‰¹ç‚¹</h2>
<p>ä¸å…¶ä»–æ—¥å¿—èšåˆç³»ç»Ÿç›¸æ¯”ï¼Œ<code>Loki</code>ï¼š</p>
<ul>
<li>ä¸å¯¹æ—¥å¿—è¿›è¡Œå…¨æ–‡ç´¢å¼•ã€‚é€šè¿‡å­˜å‚¨å‹ç¼©çš„éç»“æ„åŒ–æ—¥å¿—å’Œä»…ç´¢å¼•å…ƒæ•°æ®ï¼Œ<code>Loki</code>æ“ä½œæ›´ç®€å•ï¼Œè¿è¡Œæ›´ä¾¿å®œã€‚</li>
<li>ç´¢å¼•å’Œç»„ä½¿ç”¨ä¸<code>Prometheus</code>å·²ä½¿ç”¨çš„ç›¸åŒæ ‡ç­¾è®°å½•æµï¼Œä½¿æ‚¨å¯ä»¥ä½¿ç”¨ä¸<code>Prometheus</code>å·²ä½¿ç”¨çš„ç›¸åŒæ ‡ç­¾åœ¨æŒ‡æ ‡å’Œæ—¥å¿—ä¹‹é—´æ— ç¼åˆ‡æ¢ã€‚</li>
<li>ç‰¹åˆ«é€‚åˆå­˜æ”¾<code>Kubernetes Pod</code>æ—¥å¿—; è¯¸å¦‚<code>Pod</code>æ ‡ç­¾ä¹‹ç±»çš„å…ƒæ•°æ®ä¼šè¢«è‡ªåŠ¨åˆ é™¤å’Œç¼–å…¥ç´¢å¼•ã€‚</li>
<li>åœ¨<code>Grafana</code>æœ‰æœ¬æœºæ”¯æŒï¼ˆå·²ç»åŒ…å«åœ¨Grafana 6.0æˆ–æ›´æ–°ç‰ˆæœ¬ä¸­ï¼‰ã€‚</li>
</ul>
<h2 id="3-lokiç»„æˆ">3ã€lokiç»„æˆ</h2>
<p>Lokiç”±3ä¸ªç»„æˆéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>loki æ˜¯ä¸»æœåŠ¡å™¨ï¼Œè´Ÿè´£å­˜å‚¨æ—¥å¿—å’Œå¤„ç†æŸ¥è¯¢ã€‚</li>
<li>promtail æ˜¯ä»£ç†ï¼Œè´Ÿè´£æ”¶é›†æ—¥å¿—å¹¶å°†å…¶å‘é€ç»™lokiã€‚</li>
<li>ç”¨æˆ·ç•Œé¢çš„Grafanaã€‚</li>
</ul>
<h2 id="4-lokiå®‰è£…">4ã€lokiå®‰è£…</h2>
<p><code>loki</code>çš„å®‰è£…æ–¹å¼åŒ…å«å¦‚ä¸‹ï¼šä½¿ç”¨å®˜æ–¹çš„<code>docker</code>é•œåƒå•ç‹¬è¿è¡Œã€ä½¿ç”¨<code>helm</code>å·¥å…·åœ¨<code>kubernetes</code>ä¸Šå®‰è£…ã€ä½¿ç”¨æºç æ„å»ºã€‚<br>
æœ¬æ–‡é‡‡ç”¨çš„æ–¹æ³•æ˜¯åŸºäº<code>kubernetes</code>ç¯å¢ƒä½¿ç”¨<code>helm</code>å®‰è£…ã€‚æ‰€ä»¥å‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ª<code>kubernetes</code>ç¯å¢ƒå¹¶ä¸”å®‰è£…å¥½äº†<code>helm</code>ã€‚</p>
<pre><code>[root@k8s-qa-master-01 ~]# helm version  
Client: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
Server: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
[root@k8s-qa-master-01 ~]# helm repo list
NAME    URL                                                   
stable  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
local   http://127.0.0.1:8879/charts
</code></pre>
<h3 id="41-æ·»åŠ helmçš„chartåº“">4.1ã€æ·»åŠ helmçš„chartåº“</h3>
<pre><code>[root@k8s-qa-master-01 ~]# helm repo add loki https://grafana.github.io/loki/charts
&quot;loki&quot; has been added to your repositories
[root@k8s-qa-master-01 ~]# helm repo update
Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the &quot;stable&quot; chart repository
...Successfully got an update from the &quot;loki&quot; chart repository
Update Complete.
[root@k8s-qa-master-01 ~]# helm repo list
NAME    URL                                                   
stable  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
local   http://127.0.0.1:8879/charts                          
loki    https://grafana.github.io/loki/charts
</code></pre>
<h3 id="42-å®‰è£…lokiåŠpromtail">4.2ã€å®‰è£…lokiåŠpromtail</h3>
<p>åˆ†ä¸ºä»¥ä¸‹å¤šç§å®‰è£…æ–¹å¼ï¼š</p>
<ul>
<li>é»˜è®¤å®‰è£…</li>
</ul>
<pre><code>helm upgrade --install loki loki/loki-stack
</code></pre>
<ul>
<li>è‡ªå®šä¹‰<code>namespaces</code>å®‰è£…</li>
</ul>
<pre><code>helm upgrade --install loki --namespace=loki-stack loki/loki-stack
</code></pre>
<ul>
<li>é€‰æ‹©å®‰è£…ï¼Œåªå®‰è£…<code>loki</code>æˆ–åªå®‰è£…<code>promtail</code></li>
</ul>
<pre><code>helm upgrade --install loki loki/loki
helm upgrade --install promtail loki/promtail --set &quot;loki.serviceName=loki&quot;
</code></pre>
<ul>
<li>è‡ªå®šä¹‰é…ç½®å®‰è£…</li>
</ul>
<p>æ–¹æ³•ä¸€ï¼šåœ¨<code>helm</code>å‘½ä»¤ä¸­ä½¿ç”¨<code>--set</code>å‚æ•°è¦†ç›–é»˜è®¤<code>chart</code>ä¸­çš„é…ç½®æˆ–è€…æ˜¯<code>chart</code>ä¸­å­<code>chart</code>çš„é…ç½®ã€‚</p>
<pre><code>helm upgrade --install loki loki/loki-stack --set &quot;key1=val1,key2=val2,...&quot;
</code></pre>
<p>æ–¹æ³•äºŒï¼šåªä¸‹è½½ç›¸åº”çš„<code>chart</code>åŒ…ï¼Œä¸‹è½½åä¿®æ”¹é»˜è®¤é…ç½®å†å®‰è£…ã€‚é»˜è®¤ä¸‹è½½çš„<code>chart</code>åŒ…åœ¨~/.helm/cache/archiveç›®å½•ä¸‹ï¼Œä¾‹å¦‚ä¿®æ”¹é»˜è®¤promtailæ”¶é›†æ—¥å¿—çš„ç›®å½•</p>
<pre><code>[root@k8s-qa-master-01 archive]# pwd
/root/.helm/cache/archive
[root@k8s-qa-master-01 archive]# ls
loki-stack-0.16.3.tgz
[root@k8s-qa-master-01 archive]# tar xf loki-stack-0.16.3.tgz 
[root@k8s-qa-master-01 archive]# vim loki-stack/charts/promtail/values.yaml
Â·Â·Â·
# Extra volumes to scrape logs from
volumes:
- name: docker
  hostPath:
    path: /data/docker/containers
- name: pods
  hostPath:
    path: /var/log/pods

volumeMounts:
- name: docker
  mountPath: /data/docker/containers
  readOnly: false
- name: pods
  mountPath: /var/log/pods
  readOnly: false
Â·Â·Â·
</code></pre>
<p>ä¿®æ”¹å®Œé…ç½®åè¿›è¡Œå®‰è£…</p>
<pre><code>[root@k8s-qa-master-01 archive]# helm install ./loki-stack --name=loki --namespace=kube-system
NAME:   loki
LAST DEPLOYED: Wed Sep 25 14:29:07 2019
NAMESPACE: kube-system
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/ClusterRole
NAME                       AGE
loki-promtail-clusterrole  42s

==&gt; v1/ClusterRoleBinding
NAME                              AGE
loki-promtail-clusterrolebinding  42s

==&gt; v1/ConfigMap
NAME                  DATA  AGE
loki-loki-stack-test  1     44s
loki-promtail         1     44s

==&gt; v1/DaemonSet
NAME           DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE  NODE SELECTOR  AGE
loki-promtail  5        5        0      5           0          &lt;none&gt;         39s

==&gt; v1/Pod(related)
NAME                 READY  STATUS             RESTARTS  AGE
loki-0               0/1    Running            0         37s
loki-promtail-2lqzz  0/1    Running            0         36s
loki-promtail-8rpdj  0/1    ContainerCreating  0         37s
loki-promtail-h4lrm  0/1    Running            0         37s
loki-promtail-mbjws  0/1    Running            0         37s
loki-promtail-nj7k4  0/1    Running            0         36s

==&gt; v1/Role
NAME           AGE
loki           41s
loki-promtail  41s

==&gt; v1/RoleBinding
NAME           AGE
loki           40s
loki-promtail  40s

==&gt; v1/Secret
NAME  TYPE    DATA  AGE
loki  Opaque  1     44s

==&gt; v1/Service
NAME           TYPE       CLUSTER-IP  EXTERNAL-IP  PORT(S)   AGE
loki           ClusterIP  10.68.3.79  &lt;none&gt;       3100/TCP  39s
loki-headless  ClusterIP  None        &lt;none&gt;       3100/TCP  40s

==&gt; v1/ServiceAccount
NAME           SECRETS  AGE
loki           1        43s
loki-promtail  1        42s

==&gt; v1/StatefulSet
NAME  READY  AGE
loki  0/1    39s

==&gt; v1beta1/PodSecurityPolicy
NAME           PRIV   CAPS      SELINUX           RUNASUSER  FSGROUP    SUPGROUP  READONLYROOTFS  VOLUMES
loki           false  RunAsAny  MustRunAsNonRoot  MustRunAs  MustRunAs  true      configMap,emptyDir,persistentVolumeClaim,secret
loki-promtail  false  RunAsAny  RunAsAny          RunAsAny   RunAsAny   true      secret,configMap,hostPath


NOTES:
The Loki stack has been deployed to your cluster. Loki can now be added as a datasource in Grafana.

See http://docs.grafana.org/features/datasources/loki/ for more detail.
[root@k8s-qa-master-01 archive]# kubectl get pods -n kube-system|grep loki
loki-0                                   1/1     Running   0          2m11s
loki-promtail-2lqzz                      1/1     Running   0          2m10s
loki-promtail-8rpdj                      1/1     Running   0          2m11s
loki-promtail-h4lrm                      1/1     Running   0          2m11s
loki-promtail-mbjws                      1/1     Running   0          2m11s
loki-promtail-nj7k4                      1/1     Running   0          2m10s
</code></pre>
<h3 id="43-å®‰è£…grafana">4.3ã€å®‰è£…grafana</h3>
<p>æœ¬æ­¥éª¤çš„å‰ææ˜¯è¿˜æ²¡æœ‰å®‰è£…<code>grafana</code>ï¼Œå¦‚æœåœ¨å®‰è£…<code>loki</code>å‰å·²ç»å®‰è£…å¥½ï¼Œæ­¤æ­¥éª¤å¯å¿½ç•¥<br>
å®‰è£…</p>
<pre><code>helm install stable/grafana -n loki-grafana
</code></pre>
<p>è·å–<code>grafana</code>å¯†ç </p>
<pre><code>kubectl get secret --namespace &lt;YOUR-NAMESPACE&gt; loki-grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo
</code></pre>
<p>è®¿é—®<code>grafana</code>ï¼Œå¼€å¯ç«¯å£è½¬å‘</p>
<pre><code>kubectl port-forward --namespace &lt;YOUR-NAMESPACE&gt; service/loki-grafana 3000:80
</code></pre>
<p>å¦‚æœå°†Lokiå’ŒPromtailéƒ¨ç½²åœ¨ä¸åŒçš„ç¾¤é›†ä¸Šï¼Œåˆ™å¯ä»¥åœ¨Lokiå‰é¢æ·»åŠ ä¸€ä¸ªIngressã€‚é€šè¿‡æ·»åŠ è¯ä¹¦ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªhttpsç«¯ç‚¹ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œè¯·åœ¨Ingressä¸Šå¯ç”¨åŸºæœ¬èº«ä»½éªŒè¯,å¯å‚è€ƒ<a href="https://github.com/grafana/loki/tree/master/production/helm#run-loki-behind-https-ingress">åœ°å€</a></p>
<h2 id="5-é…ç½®å’Œä½¿ç”¨">5ã€é…ç½®å’Œä½¿ç”¨</h2>
<p>ç™»å½•åˆ°<code>gfafana</code>,é…ç½®<code>loki</code>çš„æ•°æ®æº<br>
<img src="https://image.ssgeek.com/20190925-02.png" alt=""><br>
åˆ‡æ¢åˆ°<code>grafana</code>å·¦ä¾§åŒºåŸŸçš„<code>Explore</code>ï¼Œå³å¯è¿›å…¥åˆ°<code>loki</code>çš„é¡µé¢<br>
<img src="https://image.ssgeek.com/20190925-03.png" alt=""><br>
ç‚¹å‡»<code>Log labels</code>å°±å¯ä»¥æŠŠå½“å‰ç³»ç»Ÿé‡‡é›†çš„æ—¥å¿—æ ‡ç­¾ç»™æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯ä»¥æ ¹æ®è¿™äº›æ ‡ç­¾è¿›è¡Œæ—¥å¿—çš„è¿‡æ»¤æŸ¥è¯¢,ä¹Ÿå¯ç›´æ¥è¾“å…¥è¿‡æ»¤è¡¨è¾¾å¼ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œè¿‡æ»¤å‡º<code>container</code>åç§°ä¸º<code>jenkins</code>çš„æ—¥å¿—<br>
<img src="https://image.ssgeek.com/20190925-04.png" alt=""></p>
<h2 id="6-æ—¥å¿—é€‰æ‹©å’Œè¿‡æ»¤">6ã€æ—¥å¿—é€‰æ‹©å’Œè¿‡æ»¤</h2>
<h3 id="61-æ—¥å¿—é€‰æ‹©å™¨">6.1ã€æ—¥å¿—é€‰æ‹©å™¨</h3>
<p>å¯¹äºæŸ¥è¯¢è¡¨è¾¾å¼çš„æ ‡ç­¾éƒ¨åˆ†ï¼Œå°†å…¶ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥{}ï¼Œç„¶åä½¿ç”¨é”®å€¼è¯­æ³•é€‰æ‹©æ ‡ç­¾ã€‚å¤šä¸ªæ ‡ç­¾è¡¨è¾¾å¼ç”¨é€—å·åˆ†éš”ï¼š</p>
<pre><code>{app=&quot;mysql&quot;,name=&quot;mysql-backup&quot;}
</code></pre>
<p>å½“å‰æ”¯æŒä»¥ä¸‹æ ‡ç­¾åŒ¹é…è¿ç®—ç¬¦ï¼š</p>
<ul>
<li>= å®Œå…¨ç›¸ç­‰ã€‚</li>
<li>!= ä¸ç›¸ç­‰ã€‚</li>
<li>=~ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</li>
<li>!~ ä¸è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<pre><code>{name=~&quot;mysql.+&quot;}
{name!~&quot;mysql.+&quot;}
</code></pre>
<h3 id="62-æ—¥å¿—è¿‡æ»¤å™¨">6.2ã€æ—¥å¿—è¿‡æ»¤å™¨</h3>
<p>ç¼–å†™æ—¥å¿—æµé€‰æ‹©å™¨åï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¼–å†™æœç´¢è¡¨è¾¾å¼æ¥è¿›ä¸€æ­¥è¿‡æ»¤ç»“æœã€‚æœç´¢è¡¨è¾¾å¼å¯ä»¥åªæ˜¯æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚<br>
æŸ¥è¯¢ç¤ºä¾‹ï¼š</p>
<pre><code>{job=&quot;mysql&quot;} |= &quot;error&quot;
{name=&quot;kafka&quot;} |~ &quot;tsdb-ops.*io:2003&quot;
{instance=~&quot;kafka-[23]&quot;,name=&quot;kafka&quot;} != kafka.server:type=ReplicaManager
</code></pre>
<p>è¿‡æ»¤å™¨è¿ç®—ç¬¦å¯ä»¥è¢«é“¾æ¥ï¼Œå¹¶å°†é¡ºåºè¿‡æ»¤è¡¨è¾¾å¼-ç»“æœæ—¥å¿—è¡Œå°†æ»¡è¶³æ¯ä¸ªè¿‡æ»¤å™¨ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>{job=&quot;mysql&quot;} |= &quot;error&quot; != &quot;timeout&quot;
</code></pre>
<p>å·²å®ç°ä»¥ä¸‹è¿‡æ»¤å™¨ç±»å‹ï¼š</p>
<ul>
<li>|= è¡ŒåŒ…å«å­—ç¬¦ä¸²ã€‚</li>
<li>!= è¡Œä¸åŒ…å«å­—ç¬¦ä¸²ã€‚</li>
<li>|~ è¡ŒåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>
<li>!~ è¡Œä¸æ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…ã€‚<br>
regexè¡¨è¾¾å¼æ¥å—RE2è¯­æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¹é…é¡¹åŒºåˆ†å¤§å°å†™ï¼Œå¹¶ä¸”å¯ä»¥å°†regexåˆ‡æ¢ä¸ºä¸åŒºåˆ†å¤§å°å†™çš„å‰ç¼€(?i)ã€‚</li>
</ul>
<p>ğŸ™„æ›´å¤šå†…å®¹å¯å‚è€ƒ<a href="https://github.com/grafana/loki/blob/master/docs/querying.md#grafana">å®˜æ–¹è¯´æ˜</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://www.ssgeek.com/tag/51cdo70zQ" class="tag">
                    æ—¥å¿—
                  </a>
                
                  <a href="https://www.ssgeek.com/tag/R79CtfP7Sj" class="tag">
                    loki
                  </a>
                
                  <a href="https://www.ssgeek.com/tag/P0QnFz0Xgz" class="tag">
                    grafana
                  </a>
                
                  <a href="https://www.ssgeek.com/tag/kubernetes" class="tag">
                    kubernetes
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://www.ssgeek.com/post/k8s-bao-guan-li-gong-ju-helm-jie-shao-he-an-zhuang">
                  <h3 class="post-title">
                    k8såŒ…ç®¡ç†å·¥å…·helm - ä»‹ç»å’Œå®‰è£…
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/aos/2.3.4/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '22c870a7f8551b566598',
        clientSecret: '1acfdedd403cdf39c4a6ce932a4a991bb2b32e3a',
        repo: 'hargeek.github.io',
        owner: 'hargeek',
        admin: ['hargeek'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  


  </body>
</html>
